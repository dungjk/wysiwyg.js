var wysiwyg=function(){"use strict";function e(e,t,n){var r;return function(){if(r){if(!n)return;clearTimeout(r)}var o=this,i=arguments;r=setTimeout((function(){r=null,e.apply(o,i)}),t)}}function t(e){var t=window.getSelection();return t.rangeCount>0?t.getRangeAt(0):null}function n(e,t){if(t){var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}}function r(e,t,n,r){e.addEventListener(t,n,!!r)}function o(e,t,n,r){e.removeEventListener(t,n,!!r)}function i(e){e.preventDefault(),e.stopPropagation()}function a(e,t){e.classList?e.classList.add(t):e.className+=" "+t}function c(e,t){e.classList&&e.classList.remove(t)}function l(e,t,n){for(var r=n?t.parentNode:t;r;){if(r===e)return!0;r=r.parentNode}return!1}function u(e){var t=e.nodeName;return"IMG"==t||"PICTURE"==t||"SVG"==t||"VIDEO"==t||"AUDIO"==t||"IFRAME"==t||"MAP"==t||"OBJECT"==t||"EMBED"==t}function s(e,t){e&&e.appendChild(t)}function f(e,t,n){e.insertBefore(t,n)}function d(e,t,n){e.setAttribute(t,n)}function p(e,t,n){e.style[t]=n}const h=Math.floor,g=Math.max,v=Math.min,m=Math.PI;function w(e,t,n){var r,o,i,a,c,l,u,s;switch(l=n*(1-t),u=n*(1-(c=6*e-(a=h(6*e)))*t),s=n*(1-(1-c)*t),a%6){case 0:r=n,o=s,i=l;break;case 1:r=u,o=n,i=l;break;case 2:r=l,o=n,i=s;break;case 3:r=l,o=u,i=n;break;case 4:r=s,o=l,i=n;break;case 5:r=n,o=l,i=u}var f=h(255*r).toString(16),d=h(255*o).toString(16),p=h(255*i).toString(16);return"#"+(f.length<2?"0":"")+f+(d.length<2?"0":"")+d+(p.length<2?"0":"")+p}function b(e,t){if(e.size>67108864)t();else{var n=function(n){var r=new FileReader;r.onload=function(r){if(!n||1==n||n>8)return t(e.type,r.target.result);var o=new Image;o.src=r.target.result,o.onload=function(){var r=o.width,i=o.height;if(r>i){r>4096&&(i*=4096/r,r=4096)}else{i>4096&&(r*=4096/i,i=4096)}var a=document.createElement("canvas"),c=a.getContext("2d");switch(a.width=r,a.height=i,c.save(),n>4&&(a.width=i,a.height=r),n){case 2:c.translate(r,0),c.scale(-1,1);break;case 3:c.translate(r,i),c.rotate(m);break;case 4:c.translate(0,i),c.scale(1,-1);break;case 5:c.rotate(.5*m),c.scale(1,-1);break;case 6:c.rotate(.5*m),c.translate(0,-i);break;case 7:c.rotate(.5*m),c.translate(r,-i),c.scale(-1,1);break;case 8:c.rotate(-.5*m),c.translate(-r,0)}c.drawImage(o,0,0,r,i),c.restore();var l=a.toDataURL("image/jpeg",.99);t(e.type,l)}},r.onerror=function(e){t()},r.readAsDataURL(e)};if(!window.DataView)return n();var r=new FileReader;r.onload=function(e){var t=e.target.result,r=new DataView(t);if(65496!=r.getUint16(0,!1))return n();for(var o=r.byteLength,i=2;i<o;){if(r.getUint16(i+2,!1)<=8)return n();var a=r.getUint16(i,!1);if(i+=2,65505==a){if(1165519206!=r.getUint32(i+=2,!1))return n();var c=18761==r.getUint16(i+=6,!1);i+=r.getUint32(i+4,c);var l=r.getUint16(i,c);i+=2;for(var u=0;u<l;++u)if(274==r.getUint16(i+12*u,c)){var s=r.getUint16(i+12*u+8,c);return n(s)}}else{if(65280!=(65280&a))break;i+=r.getUint16(i,!1)}}return n()},r.onerror=function(e){t()},r.readAsArrayBuffer(e)}}function k(e,t){for(var n=[],r=0,o=0;o<e.length;++o)!function(o){b(e[o],(function(i,a){for(n[o]=function(){a&&t(i,a)};r in n;)n[r](),r++;r==e.length&&(n=null)}))}(o)}var C=function(e){return!!window.getSelection().isCollapsed},E=function(){var e=window.getSelection();if(!e.isCollapsed)try{e.collapseToEnd()}catch(e){}},S=function(e,t){var n=window.getSelection();if(l(e,n.anchorNode)&&l(e,n.focusNode))return!0;if(!t)return!1;var r=document.createRange();return r.selectNodeContents(e),r.collapse(!1),n.removeAllRanges(),n.addRange(r),!0};return function(m,b){var y,L=b.toolbar,T=b.buttons,R=b.selectionbuttons,M=b.suggester,N=b.interceptenter,H=!!b.hijackmenu,I=b.width||400,P=b.height||400,A="string"==typeof m?document.querySelector(m):m,x=A.querySelector("textarea"),D={},O="top"==L,U="bottom"==L,B="demand"==L,W=A.querySelector("[contenteditable=true]");if(!W){d(W=document.createElement("div"),"contentEditable","true");var F=x.placeholder;F&&d(W,"data-placeholder",F),f(A,W,A.firstChild)}p(A,"width",I+"px"),p(W,"height",P+"px");var _=null,q=function(){_&&clearTimeout(_),_=null,a(A,"focus"),B&&a(A,"focused")},X=function(){_||document.activeElement==W||(_=setTimeout((function(){_=null,c(A,"focus")}),50))};r(W,"focus",q),r(W,"blur",X),x&&x.form&&r(x.form,"reset",X);var z=function(e,t){var n=document.createElement("input");n.placeholder="www.example.com",t&&(n.value=t.href),n.autofocus=!0,t&&r(n,"input",(function(e){var r=n.value.trim();r&&(t.href=r)})),r(n,"keypress",(function(e){if(13==(e.which||e.keyCode)){var r=n.value.trim();if(t);else if(r){var o=r;if(/^[a-z0-9]+:\/\//.test(r)||(o="http://"+r),y.getSelectedHTML())y.insertLink(o);else{var i=function(e){return e.replace(/[&<>"]/g,(function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[e]||e}))};y.insertHTML('<a href="'+i(o)+'">'+i(r)+"</a>")}}y.closePopup().collapseSelection(),W.focus()}})),a(e,"hyperlink"),s(e,n),window.setTimeout((function(){n.focus(),q()}),1)};function V(e,t){var n=document.createElement("table");n.style.borderCollapse="collapse";for(var o=1;o<15;++o){for(var c=document.createElement("tr"),l=0;l<25;++l){var u;if(24==l){var f=h(255/13*(14-o)).toString(16),d=(f.length<2?"0":"")+f;u="#"+d+d+d}else{u=w(l/24,o<=8?o/8:1,o>8?(16-o)/8:1)}var p=document.createElement("td");p.style.backgroundColor=u,p.title=u,r(p,"click",(function(e){var n=this.title;t?y.forecolor(n).closePopup().collapseSelection():y.highlight(n).closePopup().collapseSelection(),i(e)})),s(c,p)}s(n,c)}a(e,"palette"),s(e,n)}var Y=function(e,t,n){for(var r=A,o=r.offsetParent;r;){if("static"!=getComputedStyle(r).position)break;t+=r.offsetLeft,n+=r.offsetTop,o=r,r=r.offsetParent}s(o,e);var i=o.getBoundingClientRect(),a=document.documentElement,c=v(window.innerWidth,g(a.offsetWidth,a.scrollWidth)),l=window.innerHeight,u=e.offsetWidth,f=e.offsetHeight;i.left+t<1?t=1-i.left:i.left+t+u>c-1&&(t=g(1-i.left,c-1-i.left-u)),i.top+n<1?n=1-i.top:i.top+n+f>l-1&&(n=g(1-i.top,l-1-i.top-f)),e.style.left=parseInt(t)+"px",e.style.top=parseInt(n)+"px"},K=null,j=function(e,t,n,r){var o=y.activePopup();for(o&&K===t?(c(o,"animate-down"),c(o,"animate-up")):(a(o=y.openPopup(),"wysiwyg-popup"),a(o,e?"animate-down":"animate-up"),K=t);o.firstChild;)o.removeChild(o.firstChild);return n(o,r),o},G=function(e,t,n,r){var o=j(!!O,t,n,r),i=A.getBoundingClientRect(),a=e.getBoundingClientRect(),c=a.left-i.left+parseInt(e.offsetWidth/2)-parseInt(o.offsetWidth/2),l=a.top-i.top;O?l+=e.offsetHeight:l-=o.offsetHeight,Y(o,c,l)},J=function(e,t){var n=A.getBoundingClientRect(),r=W.getBoundingClientRect(),o=t.left+parseInt(t.width/2)-parseInt(e.offsetWidth/2)+r.left-n.left,i=t.top+t.height+r.top-n.top;Y(e,o,i)},$=function(e,t,n,r){var o=j(!0,t,n,r);J(o,e)},Q=null,Z=null,ee=function(e,t,n,o){n.forEach((function(n){if(n instanceof HTMLElement)return s(e,n),r(n,"focus",q),void r(n,"blur",X);var c=document.createElement("button");if(a(c,"btn"),"icon"in n){var l=document.implementation.createHTMLDocument("");l.body.innerHTML=n.icon;for(var u=l.body.firstChild;null!==u;u=u.nextSibling)s(c,u)}if("attr"in n)for(var f in n.attr)d(c,f,n.attr[f]);r(c,"focus",q),r(c,"blur",X);var p=null;"click"in n?p=function(){n.click(y,c)}:"popup"in n?p=function(){var e=function(e){n.popup(y,e,c)};t?$(t,e.toString(),e):G(c,e.toString(),e)}:"browse"in n||"dataurl"in n?p=function(){y.closePopup().collapseSelection();var e=document.createElement("input");e.type="file",e.multiple=!0,e.style.display="none",r(e,"change",(function(r){var o="dataurl"in n;if(r.target.files)if("browse"in n)for(var a=t.target.files,l=0;l<a.length;++l)n.browse(y,e,a[l],c);else k(t.target.files,(function(e,t){n.dataurl(y,e,t,c)}));else o=!0;o&&e.parentNode.removeChild(e),i(r)})),s(A,e);var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!1),e.dispatchEvent(t)}:"action"in n&&(p=function(){switch(n.action){case"link":t?$(t,"link",z,Z):G(c,"link",z,Z);break;case"bold":y.bold().closePopup().collapseSelection();break;case"italic":y.italic().closePopup().collapseSelection();break;case"underline":y.underline().closePopup().collapseSelection();break;case"strikethrough":y.strikethrough().closePopup().collapseSelection();break;case"colortext":t?$(t,"colortext",V,!0):G(c,"colortext",V,!0);break;case"colorfill":t?$(t,"colorfill",V,!1):G(c,"colorfill",V,!1);break;case"subscript":y.subscript().closePopup().collapseSelection();break;case"superscript":y.superscript().closePopup().collapseSelection();break;case"orderedlist":y.orderedList().closePopup().collapseSelection();break;case"unorderedlist":y.unorderedList().closePopup().collapseSelection();break;case"clearformat":y.removeFormat().closePopup().collapseSelection()}}),c.onclick=function(e){p&&p(),i(e)},s(e,c),"hotkey"in n&&p&&o&&(o[n.hotkey.toLowerCase()]=p)}))},te=null,ne=1,re=null,oe=function(e){e&&y.expandSelection(te.length,0).insertHTML(e),te=null,re=null,ne+=1,y.closePopup()},ie=e((function(){if(te){var e=ne;M(te,(function(t){if(Q&&e==ne)if(re=null,t){$(Q,"suggestion",(function(e){t.forEach((function(t){var n=document.createElement("div");a(n,"suggestion"),n.innerHTML=t.label,r(n,"click",(function(e){oe(t.insert),i(e)})),s(e,n),null===re&&(re=t.insert)}))}))}else oe()}))||oe()}}),100,!0),ae=function(e,t,n,r,o,i){if(N&&13==e&&!n&&!r&&!o&&!i&&(y.sync(),N()))return y.closePopup(),!1;if(t&&!n&&!r&&o&&!i){var a=t.toLowerCase();if(D[a])return D[a](),!1}return M?function(e,t,n,r,o,i){return 13!=e||!re||(oe(re),!1)}(e):void 0},ce=function(e,t,n,r,o,i){if(M)return function(e,t,n,r,o,i){switch(e){case 8:if(te&&(te=te.slice(0,-1)),te)break;return oe(),!0;case 13:case 27:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:return te&&oe(),!0;default:te||(te=""),te+=t}return ie(),!0}(e,t)},le=function(e,t,n,r){if(Q=e?t||Q:null,Z=null,t)if(e&&null!==te){var o=y.activePopup();o&&(c(o,"animate-down"),c(o,"animate-up"),J(o,t))}else{for(var i=0;i<n.length;++i){var l=n[i],f=l.closest||function(e){for(var t=this;t;){var n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;if(n&&n.call(t,e))return t;t=t.parentElement}return null};if(Z=f.call(l,"a"))break}var d=!0;r||(R?e?d=!1:n.forEach((function(e){u(e)&&(d=!1)})):d=!1),d?$(t,"selection",(function(e){var n=document.createElement("div");a(n,"toolbar"),s(e,n),ee(n,t,R)})):oe()}else oe()},ue=function(){q()},se=function(){oe(),X()},fe=null,de=null;if(x){!W.innerHTML&&x.value&&(W.innerHTML=x.value);var pe=W.innerHTML;if(fe=function(){var e=W.innerHTML;e.match(/^<br[/ ]*>$/i)&&(W.innerHTML="",e=""),e!=pe&&(x.value=e,pe=e)},r(W,"focus",(function(){var e=document.createEvent("Event");e.initEvent("focus",!1,!1),x.dispatchEvent(e)})),r(W,"blur",(function(){fe();var e=document.createEvent("Event");e.initEvent("blur",!1,!1),x.dispatchEvent(e)})),de=e(fe,250,!0),r(W,"input",de),r(W,"propertychange",de),r(W,"textInput",de),r(W,"paste",de),r(W,"cut",de),r(W,"drop",de),window.MutationObserver)new MutationObserver(de).observe(W,{attributes:!0,childList:!0,characterData:!0,subtree:!0});var he=x.form;he&&r(he,"reset",(function(){W.innerHTML="",de(),Le(!0),c(A,"focused")}))}var ge=null,ve=null;if(le){ve=e((function(e,t,n){var r=C(),o=function(e){var t=window.getSelection();if(!t.rangeCount)return[];for(var n=[],r=0;r<t.rangeCount;++r)for(var o=(u=t.getRangeAt(r)).startContainer,i=u.endContainer;o;){if(o!=e){var a=!1;if(t.containsNode)a=t.containsNode(o,!0);else{var c=document.createRange();c.selectNodeContents(o);for(r=0;r<t.rangeCount;++r){var u;if((u=t.getRangeAt(r)).compareBoundaryPoints(u.END_TO_START,c)>=0&&u.compareBoundaryPoints(u.START_TO_END,c)<=0){a=!0;break}}}a&&n.push(o)}o=function(e,t){if(e.firstChild)return e.firstChild;for(;e;){if(e==t)return null;if(e.nextSibling)return e.nextSibling;e=e.parentNode}return null}(o,o==i?i:e)}return 0==n.length&&l(e,t.focusNode)&&t.focusNode!=e&&n.push(t.focusNode),n}(W),i=null===e||null===t?null:{left:e,top:t,width:0,height:0},a=function(){var e=window.getSelection();if(!e.rangeCount)return!1;var t=e.getRangeAt(0).cloneRange();if((o=t.getBoundingClientRect())&&o.left&&o.top&&o.right&&o.bottom)return{left:parseInt(o.left),top:parseInt(o.top),width:parseInt(o.right-o.left),height:parseInt(o.bottom-o.top)};for(var n=t.getClientRects?t.getClientRects():[],r=0;r<n.length;++r){var o;if((o=n[r]).left&&o.top&&o.right&&o.bottom)return{left:parseInt(o.left),top:parseInt(o.top),width:parseInt(o.right-o.left),height:parseInt(o.bottom-o.top)}}return!1}();if(a&&(i=a),i){var c=W.getBoundingClientRect();i.left-=parseInt(c.left),i.top-=parseInt(c.top),i.left<0&&(i.left=0),i.top<0&&(i.top=0),i.width>W.offsetWidth&&(i.width=W.offsetWidth),i.height>W.offsetHeight&&(i.height=W.offsetHeight)}else if(o.length)for(var u=0;u<o.length;++u){var s=o[u];if(s.nodeType==Node.ELEMENT_NODE){i={left:s.offsetLeft,top:s.offsetTop,width:s.offsetWidth,height:s.offsetHeight};break}}le(r,i,o,n)}),1)}var me=null,we=function(e){var t=e.target||e.srcElement;t.nodeType==Node.TEXT_NODE&&(t=t.parentNode),l(me,t)||be()},be=function(){me&&(me.parentNode.removeChild(me),me=null,o(window,"mousedown",we,!0),se&&se())},ke=function(e,n){var r=e.which||e.keyCode,o=String.fromCharCode(r||e.charCode),a=e.shiftKey||!1,c=e.altKey||!1,l=e.ctrlKey||!1,u=e.metaKey||!1;if(1==n?ae&&!1===ae(r,o,a,c,l,u)&&i(e):2==n&&ce&&!1===ce(r,o)&&i(e),ge&&(ge=t()),2!=n&&3!=n||ve&&ve(null,null,!1),2==n&&de)switch(r){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:de()}};r(W,"keydown",(function(e){ke(e,1)})),r(W,"keypress",(function(e){ke(e,2)})),r(W,"keyup",(function(e){ke(e,3)}));var Ce=function(e,n){var r=null,i=null;e.clientX&&e.clientY?(r=e.clientX,i=e.clientY):e.pageX&&e.pageY&&(r=e.pageX-window.pageXOffset,i=e.pageY-window.pageYOffset),(e.which&&3==e.which||e.button&&2==e.button)&&(n=!0),o(window,"mouseup",Ce),ge&&(ge=t()),!H&&n||ve&&ve(r,i,n)},Ee=null;function Se(e,t,r){if(n(0,ge),W.focus(),!S(W,r))return!1;try{return!(document.queryCommandSupported&&!document.queryCommandSupported(e))&&document.execCommand(e,!1,t)}catch(e){}return!1}function ye(e){if(!e)return!1;var t=[];if(e.items)for(var n=e.items,r=0;r<n.length;++r){var o=n[r];if(o.type.match(/^image\//)){var i=o.getAsFile();t.push(i)}}else if(e.files){var a=e.files;for(r=0;r<a.length;++r)t.push(a[r])}return!!t.length&&(k(t,(function(e,t){Se("insertImage",t)})),!0)}function Le(e){de&&de(),e?(E(),ge=null):ge&&(ge=t())}if(r(W,"mousedown",(function(e){o(window,"mouseup",Ce),r(window,"mouseup",Ce),Ee=e.target})),r(W,"mouseup",(function(e){var t=e.target;if(t&&t.nodeType==Node.ELEMENT_NODE&&t===Ee&&u(t)&&l(W,t,!0)){var n=window.getSelection(),r=document.createRange();r.setStartBefore(t),r.setEndAfter(t),n.removeAllRanges(),n.addRange(r)}Ce(e),de&&de()})),r(W,"dblclick",(function(e){Ce(e)})),r(W,"selectionchange",(function(e){Ce(e)})),H&&r(W,"contextmenu",(function(e){Ce(e,!0),i(e)})),r(W,"paste",(function(e){ye(e.clipboardData)&&i(e)})),r(W,"drop",(function(e){ye(e.dataTransfer)&&i(e)})),y={sync:function(){return fe&&fe(),this},getHTML:function(){return W.innerHTML},setHTML:function(e){return W.innerHTML=e||"",Le(!0),this},getSelectedHTML:function(){return n(0,ge),S(W)?function(e){if(C())return null;var t=window.getSelection();if(t.rangeCount){for(var n=document.createElement("div"),r=t.rangeCount,o=0;o<r;++o){s(n,t.getRangeAt(o).cloneContents())}return n.innerHTML}return null}():null},collapseSelection:function(){return E(),ge=null,this},expandSelection:function(e,r){return n(0,ge),S(W)?(function(e,t,n){var r=window.getSelection();if(r.modify){for(var o=0;o<t;++o)r.modify("extend","backward","character");for(o=0;o<n;++o)r.modify("extend","forward","character")}else{var i=r.getRangeAt(0);i.setStart(i.startContainer,i.startOffset-t),i.setEnd(i.endContainer,i.endOffset+n),r.removeAllRanges(),r.addRange(i)}}(0,e,r),ge=t(),this):this},openPopup:function(){return ge||(ge=t()),function(){if(me)return me;r(window,"mousedown",we,!0),me=document.createElement("DIV");var e=W.parentNode,t=W.nextSibling;return t?f(e,me,t):s(e,me),ue&&ue(),me}()},activePopup:function(){return me},closePopup:function(){return be(),this},removeFormat:function(){return Se("removeFormat"),Se("unlink"),Le(),this},bold:function(){return Se("bold"),Le(),this},italic:function(){return Se("italic"),Le(),this},underline:function(){return Se("underline"),Le(),this},strikethrough:function(){return Se("strikeThrough"),Le(),this},forecolor:function(e){return Se("foreColor",e),Le(),this},highlight:function(e){return Se("hiliteColor",e)||Se("backColor",e),Le(),this},fontName:function(e){return Se("fontName",e),Le(),this},fontSize:function(e){return Se("fontSize",e),Le(),this},subscript:function(){return Se("subscript"),Le(),this},superscript:function(){return Se("superscript"),Le(),this},insertLink:function(e){return Se("createLink",e),Le(!0),this},insertImage:function(e){return Se("insertImage",e,!0),Le(!0),this},insertHTML:function(e){return Se("insertHTML",e,!0)||(n(0,ge),S(W,!0),function(e,t){var n=window.getSelection();if(n.getRangeAt&&n.rangeCount){var r=n.getRangeAt(0),o=document.createElement("div");o.innerHTML=t;for(var i,a,c=document.createDocumentFragment();i=o.firstChild;)a=s(c,i);l(e,r.commonAncestorContainer)?(r.deleteContents(),r.insertNode(c)):s(e,c),a&&((r=r.cloneRange()).setStartAfter(a),r.collapse(!0),n.removeAllRanges(),n.addRange(r))}}(W,e)),Le(!0),this},orderedList:function(){return Se("insertOrderedList"),Le(),this},unorderedList:function(){return Se("insertUnorderedList"),Le(),this}},T){var Te=document.createElement("div");if(a(Te,"toolbar"),O)a(Te,"toolbar-top"),f(A,Te,A.firstChild);else if(U)a(Te,"toolbar-bottom"),s(A,Te);else{var Re=document.createElement("div");a(Re,"toolbar-auto"),s(A,Re),s(Re,Te)}ee(Te,null,T,D)}return y}}();
