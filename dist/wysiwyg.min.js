var wysiwyg=function(){"use strict";function e(e,t,n){var r;return function(){if(r){if(!n)return;clearTimeout(r)}var o=this,i=arguments;r=setTimeout((function(){r=null,e.apply(o,i)}),t)}}function t(e){var t=window.getSelection();return t.rangeCount>0?t.getRangeAt(0):null}function n(e,t){if(t){var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}}function r(e){return e.replace(/[&<>"]/g,(function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[e]||e}))}function o(e,t,n,r){e.addEventListener(t,n,!!r)}function i(e,t,n,r){e.removeEventListener(t,n,!!r)}function a(e){e.preventDefault(),e.stopPropagation()}function c(e,t){e.classList?e.classList.add(t):e.className+=" "+t}function l(e,t){e.classList&&e.classList.remove(t)}function u(e,t,n){for(var r=n?t.parentNode:t;r;){if(r===e)return!0;r=r.parentNode}return!1}function s(e){var t=e.nodeName;return"IMG"==t||"PICTURE"==t||"SVG"==t||"VIDEO"==t||"AUDIO"==t||"IFRAME"==t||"MAP"==t||"OBJECT"==t||"EMBED"==t}function f(e,t){return e&&e.appendChild(t)}function d(e,t,n){e.insertBefore(t,n)}function p(e,t,n){e.setAttribute(t,n)}function h(e,t,n){e.style[t]=n}var g=Math.floor,v=Math.max,m=Math.min,w=Math.PI;function b(e,t,n){var r,o,i,a,c,l,u,s;switch(l=n*(1-t),u=n*(1-(c=6*e-(a=g(6*e)))*t),s=n*(1-(1-c)*t),a%6){case 0:r=n,o=s,i=l;break;case 1:r=u,o=n,i=l;break;case 2:r=l,o=n,i=s;break;case 3:r=l,o=u,i=n;break;case 4:r=s,o=l,i=n;break;case 5:r=n,o=l,i=u}var f=g(255*r).toString(16),d=g(255*o).toString(16),p=g(255*i).toString(16);return"#"+(f.length<2?"0":"")+f+(d.length<2?"0":"")+d+(p.length<2?"0":"")+p}function k(e,t){if(e.size>67108864)t();else{var n=function(n){var r=new FileReader;r.onload=function(r){if(!n||1==n||n>8)return t(e.type,r.target.result);var o=new Image;o.src=r.target.result,o.onload=function(){var r=o.width,i=o.height;if(r>i){r>4096&&(i*=4096/r,r=4096)}else{i>4096&&(r*=4096/i,i=4096)}var a=document.createElement("canvas"),c=a.getContext("2d");switch(a.width=r,a.height=i,c.save(),n>4&&(a.width=i,a.height=r),n){case 2:c.translate(r,0),c.scale(-1,1);break;case 3:c.translate(r,i),c.rotate(w);break;case 4:c.translate(0,i),c.scale(1,-1);break;case 5:c.rotate(.5*w),c.scale(1,-1);break;case 6:c.rotate(.5*w),c.translate(0,-i);break;case 7:c.rotate(.5*w),c.translate(r,-i),c.scale(-1,1);break;case 8:c.rotate(-.5*w),c.translate(-r,0)}c.drawImage(o,0,0,r,i),c.restore();var l=a.toDataURL("image/jpeg",.99);t(e.type,l)}},r.onerror=function(e){t()},r.readAsDataURL(e)};if(!window.DataView)return n();var r=new FileReader;r.onload=function(e){var t=e.target.result,r=new DataView(t);if(65496!=r.getUint16(0,!1))return n();for(var o=r.byteLength,i=2;i<o;){if(r.getUint16(i+2,!1)<=8)return n();var a=r.getUint16(i,!1);if(i+=2,65505==a){if(1165519206!=r.getUint32(i+=2,!1))return n();var c=18761==r.getUint16(i+=6,!1);i+=r.getUint32(i+4,c);var l=r.getUint16(i,c);i+=2;for(var u=0;u<l;++u)if(274==r.getUint16(i+12*u,c)){var s=r.getUint16(i+12*u+8,c);return n(s)}}else{if(65280!=(65280&a))break;i+=r.getUint16(i,!1)}}return n()},r.onerror=function(e){t()},r.readAsArrayBuffer(e)}}function E(e,t){for(var n=[],r=0,o=0;o<e.length;++o)!function(o){k(e[o],(function(i,a){for(n[o]=function(){a&&t(i,a)};r in n;)n[r](),r++;r==e.length&&(n=null)}))}(o)}var C=function(e){return!!window.getSelection().isCollapsed},S=function(){var e=window.getSelection();if(!e.isCollapsed)try{e.collapseToEnd()}catch(e){}},y=function(e,t){var n=window.getSelection();if(u(e,n.anchorNode)&&u(e,n.focusNode))return!0;if(!t)return!1;var r=document.createRange();return r.selectNodeContents(e),r.collapse(!1),n.removeAllRanges(),n.addRange(r),!0};return function(w,k){var L,T=k.toolbar,R=k.buttons,M=k.selectionbuttons,N=k.suggester,H=k.interceptenter,P=!!k.hijackmenu,A=k.width||-1,x=k.height||-1,D="string"==typeof w?document.querySelector(w):w,I=D.querySelector("textarea"),O={},U="top"==T,B="bottom"==T,W="demand"==T,F=D.querySelector("[contenteditable=true]");if(!F){p(F=document.createElement("div"),"contentEditable","true");var _=I.placeholder;_&&p(F,"data-placeholder",_),d(D,F,D.firstChild)}A>0&&h(D,"width",A+"px"),x>0&&h(F,"height",x+"px");var q=null,X=function(){q&&clearTimeout(q),q=null,c(D,"focus"),W&&c(D,"focused")},z=function(){q||document.activeElement==F||(q=setTimeout((function(){q=null,l(D,"focus")}),50))};o(F,"focus",X),o(F,"blur",z),I&&I.form&&o(I.form,"reset",z);var V=function(e,t){var n=document.createElement("input");n.placeholder="www.example.com",t&&(n.value=t.href),n.autofocus=!0,t&&o(n,"input",(function(e){var r=n.value.trim();r&&(t.href=r)})),o(n,"keypress",(function(e){if(13==(e.which||e.keyCode)){var o=n.value.trim();if(t);else if(o){var i=o;/^[a-z0-9]+:\/\//.test(o)||(i="http://"+o),L.getSelectedHTML()?L.insertLink(i):L.insertHTML('<a href="'+r(i)+'">'+r(o)+"</a>")}L.closePopup().collapseSelection(),F.focus()}})),c(e,"hyperlink"),f(e,n),window.setTimeout((function(){n.focus(),X()}),1)};function Y(e,t){var n=document.createElement("table");n.style.borderCollapse="collapse";for(var r=1;r<15;++r){for(var i=document.createElement("tr"),l=0;l<25;++l){var u;if(24==l){var s=g(255/13*(14-r)).toString(16),d=(s.length<2?"0":"")+s;u="#"+d+d+d}else{u=b(l/24,r<=8?r/8:1,r>8?(16-r)/8:1)}var p=document.createElement("td");p.style.backgroundColor=u,p.title=u,o(p,"click",(function(e){var n=this.title;t?L.forecolor(n).closePopup().collapseSelection():L.highlight(n).closePopup().collapseSelection(),a(e)})),f(i,p)}f(n,i)}c(e,"palette"),f(e,n)}var K=function(e,t,n){for(var r=D,o=r.offsetParent;r;){if("static"!=getComputedStyle(r).position)break;t+=r.offsetLeft,n+=r.offsetTop,o=r,r=r.offsetParent}f(o,e);var i=o.getBoundingClientRect(),a=document.documentElement,c=m(window.innerWidth,v(a.offsetWidth,a.scrollWidth)),l=window.innerHeight,u=e.offsetWidth,s=e.offsetHeight;i.left+t<1?t=1-i.left:i.left+t+u>c-1&&(t=v(1-i.left,c-1-i.left-u)),i.top+n<1?n=1-i.top:i.top+n+s>l-1&&(n=v(1-i.top,l-1-i.top-s)),e.style.left=parseInt(t)+"px",e.style.top=parseInt(n)+"px"},j=null,G=function(e,t,n,r){var o=L.activePopup();for(o&&j===t?(l(o,"animate-down"),l(o,"animate-up")):(c(o=L.openPopup(),"wysiwyg-popup"),c(o,e?"animate-down":"animate-up"),j=t);o.firstChild;)o.removeChild(o.firstChild);return n(o,r),o},J=function(e,t,n,r){var o=G(!!U,t,n,r),i=D.getBoundingClientRect(),a=e.getBoundingClientRect(),c=a.left-i.left+e.offsetWidth/2-o.offsetWidth/2,l=a.top-i.top;U?l+=e.offsetHeight:l-=o.offsetHeight,K(o,c,l)},$=function(e,t){var n=D.getBoundingClientRect(),r=F.getBoundingClientRect(),o=t.left+t.width/2-e.offsetWidth/2+r.left-n.left,i=t.top+t.height+r.top-n.top;K(e,o,i)},Q=function(e,t,n,r){var o=G(!0,t,n,r);$(o,e)},Z=null,ee=null,te=function(e,t,n,r){n.forEach((function(n){if(n instanceof HTMLElement)return f(e,n),o(n,"focus",X),void o(n,"blur",z);var i=document.createElement("button");if(c(i,"btn"),"icon"in n){var l=document.implementation.createHTMLDocument("");l.body.innerHTML=n.icon;for(var u=l.body.firstChild;null!==u;u=u.nextSibling)f(i,u)}"attr"in n&&Object.keys(n.attr).forEach((function(e){p(i,e,n.attr[e])})),o(i,"focus",X),o(i,"blur",z);var s=null;"click"in n?s=function(){n.click(L,i)}:"popup"in n?s=function(){var e=function(e){n.popup(L,e,i)};t?Q(t,e.toString(),e):J(i,e.toString(),e)}:"browse"in n||"dataurl"in n?s=function(){L.closePopup().collapseSelection();var e=document.createElement("input");e.type="file",e.multiple=!0,e.style.display="none",o(e,"change",(function(r){var o="dataurl"in n;if(r.target.files)if("browse"in n)for(var c=t.target.files,l=0;l<c.length;++l)n.browse(L,e,c[l],i);else E(t.target.files,(function(e,t){n.dataurl(L,e,t,i)}));else o=!0;o&&e.parentNode.removeChild(e),a(r)})),f(D,e);var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!1),e.dispatchEvent(t)}:"action"in n&&(s=function(){switch(n.action){case"link":t?Q(t,"link",V,ee):J(i,"link",V,ee);break;case"bold":L.bold().closePopup().collapseSelection();break;case"italic":L.italic().closePopup().collapseSelection();break;case"underline":L.underline().closePopup().collapseSelection();break;case"strikethrough":L.strikethrough().closePopup().collapseSelection();break;case"colortext":t?Q(t,"colortext",Y,!0):J(i,"colortext",Y,!0);break;case"colorfill":t?Q(t,"colorfill",Y,!1):J(i,"colorfill",Y,!1);break;case"subscript":L.subscript().closePopup().collapseSelection();break;case"superscript":L.superscript().closePopup().collapseSelection();break;case"orderedlist":L.orderedList().closePopup().collapseSelection();break;case"unorderedlist":L.unorderedList().closePopup().collapseSelection();break;case"clearformat":L.removeFormat().closePopup().collapseSelection()}}),i.onclick=function(e){s&&s(),a(e)},f(e,i),"hotkey"in n&&s&&r&&(r[n.hotkey.toLowerCase()]=s)}))},ne=null,re=1,oe=null,ie=function(e){e&&L.expandSelection(ne.length,0).insertHTML(e),ne=null,oe=null,re+=1,L.closePopup()},ae=e((function(){if(ne){var e=re;N(ne,(function(t){if(Z&&e==re)if(oe=null,t){Q(Z,"suggestion",(function(e){t.forEach((function(t){var n=document.createElement("div");c(n,"suggestion"),n.innerHTML=t.label,o(n,"click",(function(e){ie(t.insert),a(e)})),f(e,n),null===oe&&(oe=t.insert)}))}))}else ie()}))||ie()}}),100,!0),ce=function(e,t,n,r,o,i){if(H&&13==e&&!n&&!r&&!o&&!i&&(L.sync(),H()))return L.closePopup(),!1;if(t&&!n&&!r&&o&&!i){var a=t.toLowerCase();if(O[a])return O[a](),!1}return N?function(e,t,n,r,o,i){return 13!=e||!oe||(ie(oe),!1)}(e):void 0},le=function(e,t,n,r,o,i){if(N)return function(e,t,n,r,o,i){switch(e){case 8:if(ne&&(ne=ne.slice(0,-1)),ne)break;return ie(),!0;case 13:case 27:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:return ne&&ie(),!0;default:ne||(ne=""),ne+=t}return ae(),!0}(e,t)},ue=function(e,t,n,r){if(Z=e?t||Z:null,ee=null,t)if(e&&null!==ne){var o=L.activePopup();o&&(l(o,"animate-down"),l(o,"animate-up"),$(o,t))}else{for(var i=0;i<n.length;++i){var a=n[i],u=a.closest||function(e){for(var t=this;t;){var n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;if(n&&n.call(t,e))return t;t=t.parentElement}return null};if(ee=u.call(a,"a"))break}var d=!0;r||(M?e?d=!1:n.forEach((function(e){s(e)&&(d=!1)})):d=!1),d?Q(t,"selection",(function(e){var n=document.createElement("div");c(n,"toolbar"),f(e,n),te(n,t,M)})):ie()}else ie()},se=function(){X()},fe=function(){ie(),z()},de=null,pe=null;if(I){!F.innerHTML&&I.value&&(F.innerHTML=I.value);var he=F.innerHTML;if(de=function(){var e=F.innerHTML;e.match(/^<br[/ ]*>$/i)&&(F.innerHTML="",e=""),e!=he&&(I.value=e,he=e)},o(F,"focus",(function(){var e=document.createEvent("Event");e.initEvent("focus",!1,!1),I.dispatchEvent(e)})),o(F,"blur",(function(){de();var e=document.createEvent("Event");e.initEvent("blur",!1,!1),I.dispatchEvent(e)})),pe=e(de,250,!0),o(F,"input",pe),o(F,"propertychange",pe),o(F,"textInput",pe),o(F,"paste",pe),o(F,"cut",pe),o(F,"drop",pe),window.MutationObserver)new MutationObserver(pe).observe(F,{attributes:!0,childList:!0,characterData:!0,subtree:!0});var ge=I.form;ge&&o(ge,"reset",(function(){F.innerHTML="",pe(),Te(!0),l(D,"focused")}))}var ve=null,me=null;if(ue){me=e((function(e,t,n){var r=C(),o=function(e){var t=window.getSelection();if(!t.rangeCount)return[];for(var n=[],r=0;r<t.rangeCount;++r)for(var o=(l=t.getRangeAt(r)).startContainer,i=l.endContainer;o;){if(o!=e){var a=!1;if(t.containsNode)a=t.containsNode(o,!0);else{var c=document.createRange();c.selectNodeContents(o);for(r=0;r<t.rangeCount;++r){var l;if((l=t.getRangeAt(r)).compareBoundaryPoints(l.END_TO_START,c)>=0&&l.compareBoundaryPoints(l.START_TO_END,c)<=0){a=!0;break}}}a&&n.push(o)}o=function(e,t){if(e.firstChild)return e.firstChild;for(;e;){if(e==t)return null;if(e.nextSibling)return e.nextSibling;e=e.parentNode}return null}(o,o==i?i:e)}return 0==n.length&&u(e,t.focusNode)&&t.focusNode!=e&&n.push(t.focusNode),n}(F),i=null===e||null===t?null:{left:e,top:t,width:0,height:0},a=function(){var e=window.getSelection();if(!e.rangeCount)return!1;var t=e.getRangeAt(0).cloneRange(),n=t.getBoundingClientRect();if(n&&n.left&&n.top&&n.right&&n.bottom)return{left:n.left,top:n.top,width:n.right-n.left,height:n.bottom-n.top};for(var r=t.getClientRects?t.getClientRects():[],o=0;o<r.length;++o){var i=r[o];if(i.left&&i.top&&i.right&&i.bottom)return{left:i.left,top:i.top,width:i.right-i.left,height:i.bottom-i.top}}return!1}();if(a&&(i=a),i){var c=F.getBoundingClientRect();i.left-=parseInt(c.left),i.top-=parseInt(c.top),i.left<0&&(i.left=0),i.top<0&&(i.top=0),i.width>F.offsetWidth&&(i.width=F.offsetWidth),i.height>F.offsetHeight&&(i.height=F.offsetHeight)}else if(o.length)for(var l=0;l<o.length;++l){var s=o[l];if(s.nodeType==Node.ELEMENT_NODE){i={left:s.offsetLeft,top:s.offsetTop,width:s.offsetWidth,height:s.offsetHeight};break}}ue(r,i,o,n)}),1)}var we=null,be=function(e){var t=e.target||e.srcElement;t.nodeType==Node.TEXT_NODE&&(t=t.parentNode),u(we,t)||ke()},ke=function(){we&&(we.parentNode.removeChild(we),we=null,i(window,"mousedown",be,!0),fe&&fe())},Ee=function(e,n){var r=e.which||e.keyCode,o=String.fromCharCode(r||e.charCode),i=e.shiftKey||!1,c=e.altKey||!1,l=e.ctrlKey||!1,u=e.metaKey||!1;if(1==n?ce&&!1===ce(r,o,i,c,l,u)&&a(e):2==n&&le&&!1===le(r,o)&&a(e),ve&&(ve=t()),2!=n&&3!=n||me&&me(null,null,!1),2==n&&pe)switch(r){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:pe()}};o(F,"keydown",(function(e){Ee(e,1)})),o(F,"keypress",(function(e){Ee(e,2)})),o(F,"keyup",(function(e){Ee(e,3)}));var Ce=function(e,n){var r=null,o=null;e.clientX&&e.clientY?(r=e.clientX,o=e.clientY):e.pageX&&e.pageY&&(r=e.pageX-window.pageXOffset,o=e.pageY-window.pageYOffset),(e.which&&3==e.which||e.button&&2==e.button)&&(n=!0),i(window,"mouseup",Ce),ve&&(ve=t()),!P&&n||me&&me(r,o,n)},Se=null;function ye(e,t,r){if(n(0,ve),F.focus(),!y(F,r))return!1;try{return!(document.queryCommandSupported&&!document.queryCommandSupported(e))&&document.execCommand(e,!1,t)}catch(e){}return!1}function Le(e){if(!e)return!1;var t=[];if(e.items)for(var n=e.items,r=0;r<n.length;++r){var o=n[r];if(o.type.match(/^image\//)){var i=o.getAsFile();t.push(i)}}else if(e.files){var a=e.files;for(r=0;r<a.length;++r)t.push(a[r])}return!!t.length&&(E(t,(function(e,t){ye("insertImage",t)})),!0)}function Te(e){pe&&pe(),e?(S(),ve=null):ve&&(ve=t())}if(o(F,"mousedown",(function(e){i(window,"mouseup",Ce),o(window,"mouseup",Ce),Se=e.target})),o(F,"mouseup",(function(e){var t=e.target;if(t&&t.nodeType==Node.ELEMENT_NODE&&t===Se&&s(t)&&u(F,t,!0)){var n=window.getSelection(),r=document.createRange();r.setStartBefore(t),r.setEndAfter(t),n.removeAllRanges(),n.addRange(r)}Ce(e),pe&&pe()})),o(F,"dblclick",(function(e){Ce(e)})),o(F,"selectionchange",(function(e){Ce(e)})),P&&o(F,"contextmenu",(function(e){Ce(e,!0),a(e)})),o(F,"paste",(function(e){Le(e.clipboardData)&&a(e)})),o(F,"drop",(function(e){Le(e.dataTransfer)&&a(e)})),L={sync:function(){return de&&de(),this},getHTML:function(){return F.innerHTML},setHTML:function(e){return F.innerHTML=e||"",Te(!0),this},getSelectedHTML:function(){return n(0,ve),y(F)?function(e){if(C())return null;var t=window.getSelection();if(t.rangeCount){for(var n=document.createElement("div"),r=t.rangeCount,o=0;o<r;++o){f(n,t.getRangeAt(o).cloneContents())}return n.innerHTML}return null}():null},collapseSelection:function(){return S(),ve=null,this},expandSelection:function(e,r){return n(0,ve),y(F)?(function(e,t,n){var r=window.getSelection();if(r.modify){for(var o=0;o<t;++o)r.modify("extend","backward","character");for(o=0;o<n;++o)r.modify("extend","forward","character")}else{var i=r.getRangeAt(0);i.setStart(i.startContainer,i.startOffset-t),i.setEnd(i.endContainer,i.endOffset+n),r.removeAllRanges(),r.addRange(i)}}(0,e,r),ve=t(),this):this},openPopup:function(){return ve||(ve=t()),function(){if(we)return we;o(window,"mousedown",be,!0),we=document.createElement("DIV");var e=F.parentNode,t=F.nextSibling;return t?d(e,we,t):f(e,we),se&&se(),we}()},activePopup:function(){return we},closePopup:function(){return ke(),this},removeFormat:function(){return ye("removeFormat"),ye("unlink"),Te(),this},bold:function(){return ye("bold"),Te(),this},italic:function(){return ye("italic"),Te(),this},underline:function(){return ye("underline"),Te(),this},strikethrough:function(){return ye("strikeThrough"),Te(),this},forecolor:function(e){return ye("foreColor",e),Te(),this},highlight:function(e){return ye("hiliteColor",e)||ye("backColor",e),Te(),this},fontName:function(e){return ye("fontName",e),Te(),this},fontSize:function(e){return ye("fontSize",e),Te(),this},subscript:function(){return ye("subscript"),Te(),this},superscript:function(){return ye("superscript"),Te(),this},insertLink:function(e){return ye("createLink",e),Te(!0),this},insertImage:function(e){return ye("insertImage",e,!0),Te(!0),this},insertHTML:function(e){return ye("insertHTML",e,!0)||(n(0,ve),y(F,!0),function(e,t){var n=window.getSelection();if(n.getRangeAt&&n.rangeCount){var r=n.getRangeAt(0),o=document.createElement("div");o.innerHTML=t;for(var i,a,c=document.createDocumentFragment();i=o.firstChild;)a=f(c,i);u(e,r.commonAncestorContainer)?(r.deleteContents(),r.insertNode(c)):f(e,c),a&&((r=r.cloneRange()).setStartAfter(a),r.collapse(!0),n.removeAllRanges(),n.addRange(r))}}(F,e)),Te(!0),this},orderedList:function(){return ye("insertOrderedList"),Te(),this},unorderedList:function(){return ye("insertUnorderedList"),Te(),this}},R){var Re=document.createElement("div");if(c(Re,"toolbar"),U)c(Re,"toolbar-top"),d(D,Re,D.firstChild);else if(B)c(Re,"toolbar-bottom"),f(D,Re);else{var Me=document.createElement("div");c(Me,"toolbar-auto"),f(D,Me),f(Me,Re)}te(Re,null,R,O)}return L}}();
